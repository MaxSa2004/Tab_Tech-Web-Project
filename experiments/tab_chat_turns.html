<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tâb — Chat-like Turn Prompts (Demo)</title>
  <style>
    :root{
      --bg:#0f1724;
      --card:#0b1220;
      --p1:#eab308; /* amber */
      --p2:#60a5fa; /* blue */
      --server:#94a3b8; /* slate */
      --text:#e6eef8;
      --muted:#94a3b8;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#081126 0%, #07101b 100%); color:var(--text); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px}

    /* app layout */
    .app{
      width:1100px; max-width:100%; height:640px; display:grid; grid-template-columns:1fr 360px; gap:18px; align-items:stretch;
    }

    /* board placeholder */
    .board{
      background:linear-gradient(180deg,#081b2a,#05202b); border-radius:12px; padding:18px; display:flex; flex-direction:column; gap:12px; box-shadow:0 8px 30px rgba(2,6,23,.6);
    }
    .board h2{margin:0;font-size:20px}
    .board .grid-placeholder{flex:1;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); display:flex; align-items:center; justify-content:center; color:var(--muted); font-weight:600}
    .controls{display:flex; gap:8px}
    .btn{background:rgba(255,255,255,0.03); color:var(--text); padding:8px 12px;border-radius:8px; border:1px solid rgba(255,255,255,0.04); cursor:pointer}

    /* chat column */
    .chat{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; min-height:0; /* allow scrolling children */
    }
    .chat-header{display:flex; align-items:center; justify-content:space-between}
    .chat-header h3{margin:0;font-size:16px}
    .toggle{font-size:13px;color:var(--muted); cursor:pointer}

    .messages{flex:1; overflow:auto; padding-right:6px; display:flex; flex-direction:column; gap:10px;}

    .message{max-width:78%; display:flex; gap:10px; align-items:flex-end;}
    .message .bubble{padding:10px 12px; border-radius:12px; font-size:14px; line-height:1.25; box-shadow:0 6px 18px rgba(2,6,23,.4);}
    .message .meta{font-size:11px; color:var(--muted);}

    /* player 1 (left aligned) */
    .msg-player1{align-self:flex-start}
    .msg-player1 .bubble{background:linear-gradient(180deg, rgba(234,179,8,0.15), rgba(234,179,8,0.06)); color:var(--p1); border:1px solid rgba(234,179,8,0.18)}
    .msg-player1 .avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(180deg,var(--p1), rgba(234,179,8,0.7)); display:flex;align-items:center;justify-content:center;color:#001219;font-weight:700}

    /* player 2 (right aligned) */
    .msg-player2{align-self:flex-end; flex-direction:row-reverse}
    .msg-player2 .bubble{background:linear-gradient(180deg, rgba(96,165,250,0.12), rgba(96,165,250,0.06)); color:var(--p2); border:1px solid rgba(96,165,250,0.16)}
    .msg-player2 .avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(180deg,var(--p2), rgba(96,165,250,0.7)); display:flex;align-items:center;justify-content:center;color:#01203a;font-weight:700}

    /* server messages (center-ish) */
    .msg-server{align-self:center}
    .msg-server .bubble{background:transparent;color:var(--server); border:1px dashed rgba(148,163,184,0.12);}

    /* little subtle entry animation */
    .message{opacity:0; transform:translateY(6px); animation:msgIn .24s forwards}
    @keyframes msgIn{to{opacity:1; transform:none}}

    .input-area{display:flex; gap:8px; padding-top:8px}
    .input-area input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}

    /* responsive: collapse chat to bottom on narrow screens */
    @media (max-width:900px){
      .app{grid-template-columns:1fr; grid-auto-rows:auto auto; height:calc(100vh - 48px)}
      .chat{height:260px}
    }

  </style>
</head>
<body>
  <div class="app" role="application">
    <section class="board" aria-label="Game board area">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h2>Tâb — Demo board</h2>
        <div class="controls">
          <button class="btn" id="simDice">Simulate: "Throw your dice!"</button>
          <button class="btn" id="simMove">Simulate: "Make your move!"</button>
        </div>
      </div>
      <div class="grid-placeholder" aria-hidden="true">(board rendering here)</div>
      <div style="display:flex;gap:8px;align-items:center">
        <div style="font-size:13px;color:var(--muted)">Current player: <strong id="currentPlayer">Player 1</strong></div>
        <button class="btn" id="nextTurn">Next turn</button>
      </div>
    </section>

    <aside class="chat" aria-label="Turn messages, chat-style">
      <div class="chat-header">
        <h3>Turn prompts</h3>
        <div class="toggle" id="toggleMute">Mute sounds</div>
      </div>

      <div class="messages" id="messages" role="log" aria-live="polite" aria-atomic="false"></div>

      <div class="input-area">
        <input id="manualText" placeholder="Type a server message to simulate..." aria-label="custom message">
        <button class="btn" id="sendManual">Send</button>
      </div>
    </aside>
  </div>

  <script>
    // Demo: chat-like turn prompts for a Tâb game.
    // Features implemented:
    // - Message bubbles aligned left/right depending on player
    // - Server/neutral messages in the center
    // - Accessible live region (role=log, aria-live)
    // - Autoscroll to newest message
    // - Stubs showing how to integrate a WebSocket or SSE

    const messagesEl = document.getElementById('messages');
    const currentPlayerEl = document.getElementById('currentPlayer');
    let currentPlayer = 1;
    let soundMuted = false;

    function formatTime(d){
      return d.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }

    function autoScroll(){
      // keep scroll at bottom
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function showMessage({player=null, text, source='server'}){
      // player: 1 or 2 (optional)
      // source: 'server' | 'player' | 'system'
      const wrap = document.createElement('div');
      wrap.className = 'message';

      const avatar = document.createElement('div');
      avatar.className = 'avatar';
      avatar.setAttribute('aria-hidden','true');

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;

      const meta = document.createElement('div');
      meta.className = 'meta';
      meta.textContent = formatTime(new Date());

      if(source === 'server'){
        wrap.classList.add('msg-server');
        wrap.appendChild(bubble);
        wrap.appendChild(meta);
      } else {
        if(player === 1){
          wrap.classList.add('msg-player1');
          avatar.textContent = 'P1';
        } else {
          wrap.classList.add('msg-player2');
          avatar.textContent = 'P2';
        }
        wrap.appendChild(avatar);
        const stack = document.createElement('div');
        stack.style.display = 'flex';
        stack.style.flexDirection = 'column';
        stack.appendChild(bubble);
        stack.appendChild(meta);
        wrap.appendChild(stack);
      }

      messagesEl.appendChild(wrap);
      autoScroll();

      // small sound/announce hook
      if(!soundMuted){
        // For demo: use speechSynthesis to announce (optional & accessible)
        // NOTE: In production, consider user preference and avoid unexpected audio.
        if(typeof speechSynthesis !== 'undefined'){
          const utter = new SpeechSynthesisUtterance(text);
          utter.volume = 0.1;
          window.speechSynthesis.cancel();
          window.speechSynthesis.speak(utter);
        }
      }
    }

    // Controls for demo simulation
    document.getElementById('simDice').addEventListener('click', ()=>{
      // server tells current player to throw dice
      showMessage({player: currentPlayer, text: `Throw your dice! (Player ${currentPlayer})`, source: 'player'});
    });
    document.getElementById('simMove').addEventListener('click', ()=>{
      showMessage({player: currentPlayer, text: `Make your move!`, source: 'player'});
    });

    document.getElementById('nextTurn').addEventListener('click', ()=>{
      currentPlayer = currentPlayer === 1 ? 2 : 1;
      currentPlayerEl.textContent = 'Player ' + currentPlayer;
      showMessage({text:`It's now Player ${currentPlayer}'s turn.`, source:'server'});
    });

    document.getElementById('sendManual').addEventListener('click', ()=>{
      const t = document.getElementById('manualText');
      if(!t.value) return;
      // simulate a server message targeted to current player
      showMessage({player: currentPlayer, text: t.value, source: 'player'});
      t.value = '';
    });

    document.getElementById('toggleMute').addEventListener('click', (e)=>{
      soundMuted = !soundMuted;
      e.target.textContent = soundMuted ? 'Unmute' : 'Mute sounds';
    });

    // Example: How to integrate real-time server events
    // ---------------------------
    // Option A: WebSocket (bidirectional)
    // const ws = new WebSocket('wss://yourserver.example/game/123');
    // ws.addEventListener('open', ()=> console.log('ws open'));
    // ws.addEventListener('message', (evt)=>{
    //   // expected payload example: { type: 'prompt', text: 'Throw your dice!', player: 1 }
    //   try{
    //     const data = JSON.parse(evt.data);
    //     if(data.type === 'prompt'){
    //       showMessage({player: data.player, text: data.text, source: 'player'});
    //     } else if(data.type === 'system'){
    //       showMessage({text: data.text, source: 'server'});
    //     }
    //   }catch(e){ console.error('bad payload', e) }
    // });

    // Option B: Server-Sent Events (SSE) (unidirectional)
    // const es = new EventSource('/game/123/events');
    // es.onmessage = (evt)=>{
    //   const data = JSON.parse(evt.data);
    //   showMessage({player: data.player, text: data.text, source: data.type==='system' ? 'server' : 'player'});
    // }

    // Accessibility note: Keep aria-live on messages container (we set role=log and aria-live=polite)

    // Seed a couple of messages
    showMessage({text:'Welcome! This chat shows turn prompts and server notices.', source:'server'});
    showMessage({player:1, text:'Throw your dice!', source:'player'});

  </script>
</body>
</html>
